name: dotnet package
on: [push]
jobs:
  build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v2
    - name: SetHash
      run: (Get-Content src\dbm\DBMInfo.vb) -replace 'Const GITHASH As String = ".*?"', ('Const GITHASH As String = "' + $Env:GITHUB_SHA.SubString(0, 8) + '"') | Set-Content src\dbm\DBMInfo.vb
    - name: Certificate
      env:
        CERTIFICATE: ${{ secrets.CERTIFICATE }}
      run: ([System.Convert]::FromBase64String($Env:CERTIFICATE)) | Set-Content -NoNewline $Env:TEMP\certificate.pfx
    - name: testing
      run: dir $Env:TEMP
    - name: Build
      run: .\build.bat
    - name: Sign
      env:
        CERTPASSWORD: ${{ secrets.CERTPASSWORD }}
      run: .\sign.bat $Env:TEMP\certificate.pfx """$Env:CERTPASSWORD"""
    - name: Test
      run: build\DBMAbout.exe
